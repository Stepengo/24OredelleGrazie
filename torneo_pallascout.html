<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo Pallascout</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .nav-tab.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #3498db;
            outline: none;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .player-list {
            display: grid;
            gap: 10px;
            margin-top: 10px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .match-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .match-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .match-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .teams-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }

        .team-info {
            text-align: center;
            flex: 1;
        }

        .vs {
            margin: 0 20px;
            font-size: 20px;
            font-weight: bold;
            color: #3498db;
        }

        .stats-input {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .stats-input input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .mvp-selection {
            margin: 10px 0;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background: #3498db;
            color: white;
        }

        .table tr:hover {
            background: #f5f5f5;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tab {
                font-size: 14px;
                padding: 8px 16px;
            }
            
            .match-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-input {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ Torneo Pallascout</h1>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('teams')">Squadre</button>
                <button class="nav-tab" onclick="showTab('matches')">Partite</button>
                <button class="nav-tab" onclick="showTab('referee')">Arbitro</button>
                <button class="nav-tab" onclick="showTab('standings')">Classifica</button>
                <button class="nav-tab" onclick="showTab('stats')">Statistiche</button>
                <button class="nav-tab" onclick="showTab('admin')">Admin</button>
            </div>
        </div>

        <!-- Tab Squadre -->
        <div id="teams" class="tab-content active">
            <h2>Gestione Squadre</h2>
            <div class="form-group">
                <label>Nome Squadra:</label>
                <input type="text" id="teamName" placeholder="Inserisci nome squadra">
            </div>
            <button class="btn btn-primary" onclick="addTeam()">Aggiungi Squadra</button>
            
            <div id="teamsList"></div>
        </div>

        <!-- Tab Partite -->
        <div id="matches" class="tab-content">
            <h2>Gestione Partite</h2>
            <div class="form-group">
                <label>Squadra Casa:</label>
                <select id="homeTeam"></select>
            </div>
            <div class="form-group">
                <label>Squadra Ospite:</label>
                <select id="awayTeam"></select>
            </div>
            <div class="form-group">
                <label>Campo:</label>
                <input type="text" id="matchField" placeholder="Campo 1">
            </div>
            <button class="btn btn-primary" onclick="createMatch()">Crea Partita</button>
            
            <div id="matchesList"></div>
        </div>

        <!-- Tab Arbitro -->
        <div id="referee" class="tab-content">
            <h2>Pannello Arbitro</h2>
            <div style="margin-bottom: 20px; text-align: center;">
                <button class="btn btn-info" onclick="setArbitratorName()">üë§ Imposta Nome Arbitro</button>
                <span id="arbitratorDisplay" style="margin-left: 15px; font-weight: bold;"></span>
            </div>
            <div class="form-group">
                <label>Seleziona Partita da Arbitrare:</label>
                <select id="refereeMatchSelect" onchange="loadRefereeMatch()"></select>
            </div>
            <div id="refereePanel"></div>
        </div>

        <!-- Tab Classifica -->
        <div id="standings" class="tab-content">
            <h2>Classifica Generale</h2>
            <div id="standingsTable"></div>
        </div>

        <!-- Tab Statistiche -->
        <div id="stats" class="tab-content">
            <h2>Statistiche</h2>
            <div id="statsContent"></div>
        </div>

        <!-- Tab Admin -->
        <div id="admin" class="tab-content">
            <h2>üèÜ Pannello Organizzatore</h2>
            
            <div class="card">
                <h3>üì• Importa Report Arbitri</h3>
                <p>Importa i report ricevuti dagli arbitri per aggiornare il database centrale:</p>
                
                <div style="margin: 20px 0;">
                    <h4>Metodo 1: Importa Report Multipli</h4>
                    <textarea id="bulkReportsInput" 
                              style="width: 100%; height: 200px; margin: 10px 0;" 
                              placeholder="Incolla qui tutti i report degli arbitri, uno dopo l'altro...

üèÜ REPORT PARTITA PALLASCOUT üèÜ
üìÖ Data: 27/9/2025, 15:30:00
üèüÔ∏è Campo: Campo 1
üìä Risultato: Squadra A 3 - 1 Squadra B
...

üèÜ REPORT PARTITA PALLASCOUT üèÜ
üìÖ Data: 27/9/2025, 16:00:00
üèüÔ∏è Campo: Campo 2
üìä Risultato: Squadra C 2 - 2 Squadra D
..."></textarea>
                    <button class="btn btn-success" onclick="processBulkReports()">
                        üìä Elabora Tutti i Report
                    </button>
                </div>

                <div style="margin: 20px 0;">
                    <h4>Metodo 2: Importa File Report</h4>
                    <input type="file" id="reportFilesInput" multiple accept=".txt,.json" 
                           onchange="processReportFiles(event)">
                    <p style="font-size: 12px; color: #666;">Supporta file .txt e .json</p>
                </div>

                <div style="margin: 20px 0;">
                    <h4>Metodo 3: Importa da JSON Completo</h4>
                    <input type="file" id="jsonImportInput" accept=".json" 
                           onchange="importCompleteData(event)">
                    <p style="font-size: 12px; color: #666;">Importa database completo da un altro organizzatore</p>
                </div>
            </div>

            <div class="card">
                <h3>üìä Stato Partite</h3>
                <div id="matchStatusSummary"></div>
                <button class="btn btn-info" onclick="showDetailedMatchStatus()">
                    üìã Dettagli Partite
                </button>
            </div>

            <div class="card">
                <h3>üíæ Esporta Dati Completi</h3>
                <p>Esporta tutti i dati del torneo in diversi formati:</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <button class="btn btn-primary" onclick="exportCompleteJSON()">
                        üìÑ Esporta JSON Completo
                    </button>
                    <button class="btn btn-success" onclick="exportExcelFormat()">
                        üìä Esporta per Excel
                    </button>
                    <button class="btn btn-warning" onclick="exportPrintableReport()">
                        üñ®Ô∏è Report Stampabile
                    </button>
                    <button class="btn btn-info" onclick="exportWebPage()">
                        üåê Pagina Web Risultati
                    </button>
                </div>
            </div>

            <div class="card">
                <h3>üîß Strumenti Admin</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <button class="btn btn-warning" onclick="validateData()">
                        ‚úÖ Valida Dati
                    </button>
                    <button class="btn btn-info" onclick="showDataStatistics()">
                        üìà Statistiche Database
                    </button>
                    <button class="btn btn-success" onclick="backupData()">
                        üíæ Backup Completo
                    </button>
                    <button class="btn btn-danger" onclick="resetTournament()">
                        üóëÔ∏è Reset Torneo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal per aggiungere giocatori -->
    <div id="playerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePlayerModal()">&times;</span>
            <h3 id="modalTitle">Aggiungi Giocatore</h3>
            <div class="form-group">
                <label>Nome Giocatore:</label>
                <input type="text" id="playerName">
            </div>
            <div class="form-group">
                <label>Numero Maglia:</label>
                <input type="number" id="playerNumber" min="1">
            </div>
            <button class="btn btn-primary" onclick="addPlayer()">Aggiungi</button>
        </div>
    </div>

    <script>
        // Strutture dati
        let teams = JSON.parse(localStorage.getItem('pallascout_teams') || '[]');
        let matches = JSON.parse(localStorage.getItem('pallascout_matches') || '[]');
        let currentTeamId = null;

        // Funzioni di salvataggio
        function saveData() {
            localStorage.setItem('pallascout_teams', JSON.stringify(teams));
            localStorage.setItem('pallascout_matches', JSON.stringify(matches));
        }

        // Gestione tab
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'matches') {
                updateTeamSelects();
                displayMatches();
            } else if (tabName === 'referee') {
                updateRefereeMatchSelect();
                updateArbitratorDisplay();
            } else if (tabName === 'standings') {
                displayStandings();
            } else if (tabName === 'stats') {
                displayStats();
            } else if (tabName === 'teams') {
                displayTeams();
            } else if (tabName === 'admin') {
                updateMatchStatusSummary();
            }
        }

        // Gestione squadre
        function addTeam() {
            const teamName = document.getElementById('teamName').value.trim();
            if (!teamName) {
                alert('Inserisci un nome per la squadra');
                return;
            }

            const team = {
                id: Date.now(),
                name: teamName,
                players: [],
                stats: {
                    matches: 0,
                    wins: 0,
                    draws: 0,
                    losses: 0,
                    points: 0,
                    goalsFor: 0,
                    goalsAgainst: 0,
                    scalpFor: 0,
                    scalpAgainst: 0
                }
            };

            teams.push(team);
            saveData();
            document.getElementById('teamName').value = '';
            displayTeams();
        }

        function displayTeams() {
            const teamsList = document.getElementById('teamsList');
            teamsList.innerHTML = '';

            teams.forEach(team => {
                const teamCard = document.createElement('div');
                teamCard.className = 'card';
                teamCard.innerHTML = `
                    <h3>${team.name}</h3>
                    <p>Giocatori: ${team.players.length}</p>
                    <div class="player-list" id="players-${team.id}">
                        ${team.players.map(player => `
                            <div class="player-item">
                                <span>#${player.number} - ${player.name}</span>
                                <button class="btn btn-danger" onclick="removePlayer(${team.id}, ${player.id})">Rimuovi</button>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-success" onclick="openPlayerModal(${team.id})">Aggiungi Giocatore</button>
                    <button class="btn btn-danger" onclick="removeTeam(${team.id})">Elimina Squadra</button>
                `;
                teamsList.appendChild(teamCard);
            });
        }

        function openPlayerModal(teamId) {
            currentTeamId = teamId;
            const team = teams.find(t => t.id === teamId);
            document.getElementById('modalTitle').textContent = `Aggiungi Giocatore - ${team.name}`;
            document.getElementById('playerModal').style.display = 'block';
        }

        function closePlayerModal() {
            document.getElementById('playerModal').style.display = 'none';
            document.getElementById('playerName').value = '';
            document.getElementById('playerNumber').value = '';
        }

        function addPlayer() {
            const playerName = document.getElementById('playerName').value.trim();
            const playerNumber = parseInt(document.getElementById('playerNumber').value);
            
            if (!playerName || !playerNumber) {
                alert('Inserisci nome e numero del giocatore');
                return;
            }

            const team = teams.find(t => t.id === currentTeamId);
            if (team.players.some(p => p.number === playerNumber)) {
                alert('Numero maglia gi√† utilizzato');
                return;
            }

            const player = {
                id: Date.now(),
                name: playerName,
                number: playerNumber,
                stats: {
                    goals: 0,
                    scalps: 0,
                    mvp: 0
                }
            };

            team.players.push(player);
            saveData();
            closePlayerModal();
            displayTeams();
        }

        function removePlayer(teamId, playerId) {
            const team = teams.find(t => t.id === teamId);
            team.players = team.players.filter(p => p.id !== playerId);
            saveData();
            displayTeams();
        }

        function removeTeam(teamId) {
            if (confirm('Sei sicuro di voler eliminare questa squadra?')) {
                teams = teams.filter(t => t.id !== teamId);
                saveData();
                displayTeams();
            }
        }

        // Gestione partite
        function updateTeamSelects() {
            const homeSelect = document.getElementById('homeTeam');
            const awaySelect = document.getElementById('awayTeam');
            
            const options = '<option value="">Seleziona squadra</option>' + 
                          teams.map(team => `<option value="${team.id}">${team.name}</option>`).join('');
            
            homeSelect.innerHTML = options;
            awaySelect.innerHTML = options;
        }

        function createMatch() {
            const homeTeamId = parseInt(document.getElementById('homeTeam').value);
            const awayTeamId = parseInt(document.getElementById('awayTeam').value);
            const field = document.getElementById('matchField').value.trim();

            if (!homeTeamId || !awayTeamId || homeTeamId === awayTeamId) {
                alert('Seleziona due squadre diverse');
                return;
            }

            const match = {
                id: Date.now(),
                homeTeamId,
                awayTeamId,
                field: field || 'Campo TBD',
                status: 'scheduled', // scheduled, in_progress, completed
                homeScore: 0,
                awayScore: 0,
                playerStats: {},
                homeMVP: null,
                awayMVP: null,
                startTime: new Date().toISOString()
            };

            matches.push(match);
            saveData();
            displayMatches();
            
            // Aggiorna anche il dropdown arbitro se √® visibile
            updateRefereeMatchSelect();
            
            // Reset form
            document.getElementById('homeTeam').value = '';
            document.getElementById('awayTeam').value = '';
            document.getElementById('matchField').value = '';
            
            console.log('Nuova partita creata:', match);
        }

        function displayMatches() {
            const matchesList = document.getElementById('matchesList');
            matchesList.innerHTML = '<div class="match-grid"></div>';
            const matchGrid = matchesList.querySelector('.match-grid');

            matches.forEach(match => {
                const homeTeam = teams.find(t => t.id === match.homeTeamId);
                const awayTeam = teams.find(t => t.id === match.awayTeamId);
                
                if (!homeTeam || !awayTeam) return;

                const matchCard = document.createElement('div');
                matchCard.className = 'match-card';
                matchCard.innerHTML = `
                    <div class="match-header">
                        <h4>${match.field}</h4>
                        <span class="badge ${getStatusBadge(match.status)}">${getStatusText(match.status)}</span>
                    </div>
                    <div class="teams-display">
                        <div class="team-info">
                            <h5>${homeTeam.name}</h5>
                            <span class="score">${match.homeScore}</span>
                        </div>
                        <div class="vs">VS</div>
                        <div class="team-info">
                            <h5>${awayTeam.name}</h5>
                            <span class="score">${match.awayScore}</span>
                        </div>
                    </div>
                    <button class="btn btn-warning" onclick="deleteMatch(${match.id})">Elimina</button>
                `;
                matchGrid.appendChild(matchCard);
            });
        }

        function getStatusBadge(status) {
            switch(status) {
                case 'scheduled': return 'badge-secondary';
                case 'in_progress': return 'badge-warning';
                case 'completed': return 'badge-success';
                default: return 'badge-secondary';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'scheduled': return 'Programmata';
                case 'in_progress': return 'In corso';
                case 'completed': return 'Completata';
                default: return 'Sconosciuto';
            }
        }

        function deleteMatch(matchId) {
            if (confirm('Sei sicuro di voler eliminare questa partita?')) {
                matches = matches.filter(m => m.id !== matchId);
                saveData();
                displayMatches();
            }
        }

        // Gestione arbitro
        function updateRefereeMatchSelect() {
            const select = document.getElementById('refereeMatchSelect');
            if (!select) return;
            
            // Filtra solo le partite non completate
            const availableMatches = matches.filter(m => m.status === 'scheduled' || m.status === 'in_progress');
            
            console.log('Partite disponibili:', availableMatches); // Debug
            console.log('Tutte le partite:', matches); // Debug
            console.log('Squadre disponibili:', teams); // Debug
            
            if (availableMatches.length === 0) {
                select.innerHTML = '<option value="">Nessuna partita disponibile</option>';
                return;
            }
            
            let optionsHTML = '<option value="">Seleziona partita da arbitrare</option>';
            
            availableMatches.forEach(match => {
                const homeTeam = teams.find(t => t.id === match.homeTeamId);
                const awayTeam = teams.find(t => t.id === match.awayTeamId);
                
                if (homeTeam && awayTeam) {
                    const status = match.status === 'in_progress' ? ' (In corso)' : '';
                    optionsHTML += `<option value="${match.id}">${homeTeam.name} vs ${awayTeam.name} - ${match.field}${status}</option>`;
                } else {
                    console.error('Squadre non trovate per partita:', match);
                }
            });
            
            select.innerHTML = optionsHTML;
            
            // Aggiorna display nome arbitro
            updateArbitratorDisplay();
        }

        function updateArbitratorDisplay() {
            const display = document.getElementById('arbitratorDisplay');
            if (!display) return;
            
            const name = getArbitratorName();
            if (name) {
                display.textContent = `Arbitro: ${name}`;
                display.style.color = '#27ae60';
            } else {
                display.textContent = '(Nome non impostato - clicca per impostarlo)';
                display.style.color = '#e74c3c';
            }
        }

        function loadRefereeMatch() {
            const matchId = parseInt(document.getElementById('refereeMatchSelect').value);
            if (!matchId) {
                document.getElementById('refereePanel').innerHTML = '';
                return;
            }

            const match = matches.find(m => m.id === matchId);
            if (!match) {
                alert('Partita non trovata');
                return;
            }

            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);

            if (!homeTeam || !awayTeam) {
                alert('Errore: squadre della partita non trovate');
                return;
            }

            if (match.status === 'scheduled') {
                match.status = 'in_progress';
                saveData();
            }

            // Inizializza playerStats se non esiste
            if (!match.playerStats) {
                match.playerStats = {};
            }

            document.getElementById('refereePanel').innerHTML = `
                <div class="card">
                    <h3>${homeTeam.name} vs ${awayTeam.name}</h3>
                    <div class="teams-display">
                        <div class="team-info">
                            <h4 id="homeScore">${homeTeam.name}: ${match.homeScore || 0}</h4>
                        </div>
                        <div class="vs">VS</div>
                        <div class="team-info">
                            <h4 id="awayScore">${awayTeam.name}: ${match.awayScore || 0}</h4>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div>
                            <h4>${homeTeam.name}</h4>
                            <div id="homePlayersStats">
                                ${homeTeam.players.map(player => `
                                    <div class="player-stats" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                                        <strong>#${player.number} ${player.name}</strong>
                                        <div class="stats-input" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px;">
                                            <input type="number" placeholder="Gol" min="0" 
                                                   value="${match.playerStats[player.id]?.goals || 0}"
                                                   onchange="updatePlayerStat(${match.id}, ${player.id}, 'goals', this.value)"
                                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                            <input type="number" placeholder="Scalpi" min="0" 
                                                   value="${match.playerStats[player.id]?.scalps || 0}"
                                                   onchange="updatePlayerStat(${match.id}, ${player.id}, 'scalps', this.value)"
                                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                            <label style="display: flex; align-items: center; justify-content: center;">
                                                <input type="radio" name="homeMVP" value="${player.id}" 
                                                       ${match.homeMVP === player.id ? 'checked' : ''}
                                                       onchange="updateMVP(${match.id}, 'home', ${player.id})"
                                                       style="margin-right: 5px;"> MVP
                                            </label>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h4>${awayTeam.name}</h4>
                            <div id="awayPlayersStats">
                                ${awayTeam.players.map(player => `
                                    <div class="player-stats" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                                        <strong>#${player.number} ${player.name}</strong>
                                        <div class="stats-input" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px;">
                                            <input type="number" placeholder="Gol" min="0" 
                                                   value="${match.playerStats[player.id]?.goals || 0}"
                                                   onchange="updatePlayerStat(${match.id}, ${player.id}, 'goals', this.value)"
                                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                            <input type="number" placeholder="Scalpi" min="0" 
                                                   value="${match.playerStats[player.id]?.scalps || 0}"
                                                   onchange="updatePlayerStat(${match.id}, ${player.id}, 'scalps', this.value)"
                                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                            <label style="display: flex; align-items: center; justify-content: center;">
                                                <input type="radio" name="awayMVP" value="${player.id}" 
                                                       ${match.awayMVP === player.id ? 'checked' : ''}
                                                       onchange="updateMVP(${match.id}, 'away', ${player.id})"
                                                       style="margin-right: 5px;"> MVP
                                            </label>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-success" onclick="completeMatch(${match.id})">Termina Partita</button>
                        <button class="btn btn-warning" onclick="saveMatchProgress(${match.id})">Salva Progresso</button>
                    </div>
                </div>
            `;
        }

        function updatePlayerStat(matchId, playerId, stat, value) {
            const match = matches.find(m => m.id === matchId);
            if (!match) return;
            
            if (!match.playerStats) {
                match.playerStats = {};
            }
            
            if (!match.playerStats[playerId]) {
                match.playerStats[playerId] = { goals: 0, scalps: 0 };
            }
            
            match.playerStats[playerId][stat] = parseInt(value) || 0;
            
            // Ricalcola il punteggio
            calculateMatchScore(match);
            saveData();
            
            // Aggiorna il display del punteggio
            updateScoreDisplay(match);
        }

        function updateScoreDisplay(match) {
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            const homeScoreElement = document.getElementById('homeScore');
            const awayScoreElement = document.getElementById('awayScore');
            
            if (homeScoreElement) {
                homeScoreElement.textContent = `${homeTeam.name}: ${match.homeScore || 0}`;
            }
            if (awayScoreElement) {
                awayScoreElement.textContent = `${awayTeam.name}: ${match.awayScore || 0}`;
            }
        }

        function updateMVP(matchId, team, playerId) {
            const match = matches.find(m => m.id === matchId);
            if (!match) return;
            
            if (team === 'home') {
                match.homeMVP = parseInt(playerId);
            } else {
                match.awayMVP = parseInt(playerId);
            }
            saveData();
        }

        function calculateMatchScore(match) {
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            if (!homeTeam || !awayTeam) return;
            
            let homeScore = 0;
            let awayScore = 0;

            // Calcola gol per squadra casa
            homeTeam.players.forEach(player => {
                if (match.playerStats && match.playerStats[player.id]) {
                    homeScore += match.playerStats[player.id].goals || 0;
                }
            });

            // Calcola gol per squadra ospite
            awayTeam.players.forEach(player => {
                if (match.playerStats && match.playerStats[player.id]) {
                    awayScore += match.playerStats[player.id].goals || 0;
                }
            });

            match.homeScore = homeScore;
            match.awayScore = awayScore;
        }

        function saveMatchProgress(matchId) {
            const match = matches.find(m => m.id === matchId);
            if (!match) return;
            
            saveData();
            alert('‚úÖ Progresso della partita salvato!');
        }

        function completeMatch(matchId) {
            if (!confirm('Sei sicuro di voler terminare questa partita?')) return;
            
            const match = matches.find(m => m.id === matchId);
            if (!match) {
                alert('Errore: partita non trovata');
                return;
            }
            
            match.status = 'completed';
            match.completedAt = new Date().toISOString();
            
            // Aggiorna le statistiche delle squadre
            updateTeamStats(match);
            updatePlayerStats(match);
            
            saveData();
            
            // Mostra opzioni per inviare i dati
            showMatchCompletedOptions(match);
        }

        function showMatchCompletedOptions(match) {
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            if (!homeTeam || !awayTeam) {
                alert('Errore: squadre non trovate');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <h3>‚úÖ Partita Completata!</h3>
                    <p><strong>${homeTeam.name} ${match.homeScore || 0} - ${match.awayScore || 0} ${awayTeam.name}</strong></p>
                    <p>Campo: ${match.field}</p>
                    
                    <div style="margin: 20px 0;">
                        <h4>Invia i risultati all'organizzatore:</h4>
                        <div style="display: grid; gap: 10px; margin-top: 15px;">
                            <button class="btn btn-primary" onclick="sendMatchByEmail(${match.id})">
                                üìß Invia via Email
                            </button>
                            <button class="btn btn-success" onclick="sendMatchByWhatsApp(${match.id})">
                                üì± Invia via WhatsApp
                            </button>
                            <button class="btn btn-warning" onclick="copyMatchData(${match.id})">
                                üìã Copia Dati negli Appunti
                            </button>
                            <button class="btn btn-info" onclick="downloadMatchReport(${match.id})">
                                üíæ Scarica Report Partita
                            </button>
                            <button class="btn btn-secondary" onclick="shareMatchData(${match.id})">
                                üì§ Condividi (Web Share)
                            </button>
                            <button class="btn" style="background: #25D366; color: white;" onclick="sendViaTelegram(${match.id})">
                                üí¨ Invia via Telegram
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-secondary" onclick="closeMatchCompletedModal()">
                            Chiudi
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeMatchCompletedModal() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.remove();
            }
            updateRefereeMatchSelect();
            document.getElementById('refereePanel').innerHTML = '';
        }

        function generateMatchReport(matchId) {
            const match = matches.find(m => m.id === matchId);
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            let report = `üèÜ REPORT PARTITA PALLASCOUT üèÜ\n\n`;
            report += `üìÖ Data: ${new Date(match.completedAt).toLocaleString('it-IT')}\n`;
            report += `üèüÔ∏è Campo: ${match.field}\n`;
            report += `üìä Risultato: ${homeTeam.name} ${match.homeScore} - ${match.awayScore} ${awayTeam.name}\n\n`;
            
            // Statistiche squadra casa
            report += `üè† ${homeTeam.name.toUpperCase()}\n`;
            report += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            homeTeam.players.forEach(player => {
                const stats = match.playerStats[player.id];
                if (stats && (stats.goals > 0 || stats.scalps > 0)) {
                    report += `#${player.number} ${player.name}: ${stats.goals || 0} gol, ${stats.scalps || 0} scalpi`;
                    if (match.homeMVP === player.id) report += ` ‚≠ê MVP`;
                    report += `\n`;
                }
            });
            
            // Statistiche squadra ospite  
            report += `\nüöå ${awayTeam.name.toUpperCase()}\n`;
            report += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            awayTeam.players.forEach(player => {
                const stats = match.playerStats[player.id];
                if (stats && (stats.goals > 0 || stats.scalps > 0)) {
                    report += `#${player.number} ${player.name}: ${stats.goals || 0} gol, ${stats.scalps || 0} scalpi`;
                    if (match.awayMVP === player.id) report += ` ‚≠ê MVP`;
                    report += `\n`;
                }
            });
            
            report += `\nüìã ARBITRO: ${getArbitratorName() || 'N/D'}\n`;
            report += `\nüî¢ ID PARTITA: ${match.id}\n`;
            report += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            report += `Generato da: Torneo Pallascout App`;
            
            return report;
        }

        function sendMatchByEmail(matchId) {
            const report = generateMatchReport(matchId);
            const match = matches.find(m => m.id === matchId);
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            const subject = encodeURIComponent(`Report Partita: ${homeTeam.name} vs ${awayTeam.name}`);
            const body = encodeURIComponent(report);
            
            // Mostra opzioni multiple per l'invio email
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.remove()">&times;</span>
                    <h3>üìß Invia Report via Email</h3>
                    
                    <div style="margin: 20px 0;">
                        <label>Email organizzatore:</label>
                        <input type="email" id="organizerEmail" placeholder="organizzatore@email.com" style="width: 100%; padding: 8px; margin: 5px 0;">
                    </div>
                    
                    <div style="display: grid; gap: 10px;">
                        <button class="btn btn-primary" onclick="openEmailClient('${matchId}')">
                            üì¨ Apri Client Email (Outlook, Thunderbird, etc.)
                        </button>
                        <button class="btn btn-success" onclick="openGmail('${matchId}')">
                            üìß Apri Gmail
                        </button>
                        <button class="btn btn-info" onclick="openYahooMail('${matchId}')">
                            üìÆ Apri Yahoo Mail
                        </button>
                        <button class="btn btn-warning" onclick="copyEmailText('${matchId}')">
                            üìã Copia Testo Email
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 12px;">
                        üí° <strong>Suggerimento:</strong> Se nessuna opzione funziona, usa "Copia Testo Email" 
                        e incollalo manualmente nella tua app email preferita.
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function openEmailClient(matchId) {
            const email = document.getElementById('organizerEmail').value.trim();
            if (!email) {
                alert('Inserisci l\'email dell\'organizzatore');
                return;
            }
            
            const report = generateMatchReport(matchId);
            const match = matches.find(m => m.id === matchId);
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            const subject = encodeURIComponent(`Report Partita: ${homeTeam.name} vs ${awayTeam.name}`);
            const body = encodeURIComponent(report);
            
            const mailtoLink = `mailto:${email}?subject=${subject}&body=${body}`;
            
            try {
                window.open(mailtoLink);
                document.querySelector('.modal').remove();
            } catch (error) {
                alert('Impossibile aprire il client email. Prova con "Copia Testo Email".');
            }
        }

        function openGmail(matchId) {
            const email = document.getElementById('organizerEmail').value.trim();
            if (!email) {
                alert('Inserisci l\'email dell\'organizzatore');
                return;
            }
            
            const report = generateMatchReport(matchId);
            const match = matches.find(m => m.id === matchId);
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            const subject = encodeURIComponent(`Report Partita: ${homeTeam.name} vs ${awayTeam.name}`);
            const body = encodeURIComponent(report);
            
            const gmailUrl = `https://mail.google.com/mail/?view=cm&to=${email}&subject=${subject}&body=${body}`;
            window.open(gmailUrl, '_blank');
            document.querySelector('.modal').remove();
        }

        function openYahooMail(matchId) {
            const email = document.getElementById('organizerEmail').value.trim();
            if (!email) {
                alert('Inserisci l\'email dell\'organizzatore');
                return;
            }
            
            const report = generateMatchReport(matchId);
            const match = matches.find(m => m.id === matchId);
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            const subject = encodeURIComponent(`Report Partita: ${homeTeam.name} vs ${awayTeam.name}`);
            const body = encodeURIComponent(report);
            
            const yahooUrl = `https://compose.mail.yahoo.com/?to=${email}&subject=${subject}&body=${body}`;
            window.open(yahooUrl, '_blank');
            document.querySelector('.modal').remove();
        }

        function copyEmailText(matchId) {
            const email = document.getElementById('organizerEmail').value.trim() || 'organizzatore@email.com';
            const report = generateMatchReport(matchId);
            const match = matches.find(m => m.id === matchId);
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            const emailText = `A: ${email}
Oggetto: Report Partita: ${homeTeam.name} vs ${awayTeam.name}

${report}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(emailText).then(() => {
                    alert('‚úÖ Testo email copiato! Incollalo nella tua app email preferita.');
                    document.querySelector('.modal').remove();
                });
            } else {
                const textArea = document.createElement("textarea");
                textArea.value = emailText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('‚úÖ Testo email copiato! Incollalo nella tua app email preferita.');
                document.querySelector('.modal').remove();
            }
        }

        function sendMatchByWhatsApp(matchId) {
            const report = generateMatchReport(matchId);
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.remove()">&times;</span>
                    <h3>üì± Invia via WhatsApp</h3>
                    
                    <div style="margin: 20px 0;">
                        <label>Numero WhatsApp organizzatore:</label>
                        <input type="tel" id="organizerPhone" placeholder="+393401234567" style="width: 100%; padding: 8px; margin: 5px 0;">
                        <small style="color: #666;">Formato: +39 seguito dal numero (es: +393401234567)</small>
                    </div>
                    
                    <div style="display: grid; gap: 10px;">
                        <button class="btn btn-success" onclick="openWhatsAppWeb('${matchId}')">
                            üíª Apri WhatsApp Web
                        </button>
                        <button class="btn btn-success" onclick="openWhatsAppMobile('${matchId}')">
                            üì± Apri WhatsApp Mobile
                        </button>
                        <button class="btn btn-warning" onclick="copyWhatsAppText('${matchId}')">
                            üìã Copia Testo per WhatsApp
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function openWhatsAppWeb(matchId) {
            const phone = document.getElementById('organizerPhone').value.trim();
            if (!phone) {
                alert('Inserisci il numero WhatsApp dell\'organizzatore');
                return;
            }
            
            const report = generateMatchReport(matchId);
            const encodedReport = encodeURIComponent(report);
            const cleanPhone = phone.replace(/[^0-9]/g, '');
            
            const whatsappUrl = `https://web.whatsapp.com/send?phone=${cleanPhone}&text=${encodedReport}`;
            window.open(whatsappUrl, '_blank');
            document.querySelector('.modal').remove();
        }

        function openWhatsAppMobile(matchId) {
            const phone = document.getElementById('organizerPhone').value.trim();
            if (!phone) {
                alert('Inserisci il numero WhatsApp dell\'organizzatore');
                return;
            }
            
            const report = generateMatchReport(matchId);
            const encodedReport = encodeURIComponent(report);
            const cleanPhone = phone.replace(/[^0-9]/g, '');
            
            const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodedReport}`;
            window.open(whatsappUrl, '_blank');
            document.querySelector('.modal').remove();
        }

        function copyWhatsAppText(matchId) {
            const report = generateMatchReport(matchId);
            const phone = document.getElementById('organizerPhone').value.trim() || '+393401234567';
            
            const whatsappText = `Per: ${phone}

${report}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(report).then(() => {
                    alert('‚úÖ Testo copiato! Aprilo WhatsApp manualmente e incollalo nella chat con l\'organizzatore.');
                    document.querySelector('.modal').remove();
                });
            } else {
                fallbackCopyTextToClipboard(report);
                document.querySelector('.modal').remove();
            }
        }

        function shareMatchData(matchId) {
            const report = generateMatchReport(matchId);
            const match = matches.find(m => m.id === matchId);
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            if (navigator.share) {
                navigator.share({
                    title: `Report Partita: ${homeTeam.name} vs ${awayTeam.name}`,
                    text: report
                }).then(() => {
                    console.log('Report condiviso con successo');
                }).catch((error) => {
                    console.log('Errore nella condivisione:', error);
                    // Fallback su copia negli appunti
                    copyMatchData(matchId);
                });
            } else {
                alert('La condivisione web non √® supportata su questo dispositivo. Usa "Copia Dati negli Appunti".');
                copyMatchData(matchId);
            }
        }

        function sendViaTelegram(matchId) {
            const report = generateMatchReport(matchId);
            const encodedReport = encodeURIComponent(report);
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.remove()">&times;</span>
                    <h3>üí¨ Invia via Telegram</h3>
                    
                    <div style="margin: 20px 0;">
                        <label>Username Telegram organizzatore:</label>
                        <input type="text" id="telegramUsername" placeholder="@organizzatore" style="width: 100%; padding: 8px; margin: 5px 0;">
                        <small style="color: #666;">Inserisci @username o lascia vuoto per aprire Telegram senza destinatario</small>
                    </div>
                    
                    <div style="display: grid; gap: 10px;">
                        <button class="btn" style="background: #0088cc; color: white;" onclick="openTelegramWeb('${matchId}')">
                            üíª Apri Telegram Web
                        </button>
                        <button class="btn" style="background: #0088cc; color: white;" onclick="openTelegramApp('${matchId}')">
                            üì± Apri App Telegram
                        </button>
                        <button class="btn btn-warning" onclick="copyTelegramText('${matchId}')">
                            üìã Copia Testo per Telegram
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function openTelegramWeb(matchId) {
            const username = document.getElementById('telegramUsername').value.trim();
            const report = generateMatchReport(matchId);
            const encodedReport = encodeURIComponent(report);
            
            let telegramUrl;
            if (username) {
                const cleanUsername = username.replace('@', '');
                telegramUrl = `https://web.telegram.org/k/#@${cleanUsername}`;
            } else {
                telegramUrl = `https://web.telegram.org/k/`;
            }
            
            // Prima apri Telegram, poi copia il testo
            window.open(telegramUrl, '_blank');
            
            setTimeout(() => {
                copyTelegramText(matchId);
            }, 1000);
        }

        function openTelegramApp(matchId) {
            const username = document.getElementById('telegramUsername').value.trim();
            const report = generateMatchReport(matchId);
            const encodedReport = encodeURIComponent(report);
            
            let telegramUrl;
            if (username) {
                const cleanUsername = username.replace('@', '');
                telegramUrl = `tg://resolve?domain=${cleanUsername}&text=${encodedReport}`;
            } else {
                telegramUrl = `tg://msg?text=${encodedReport}`;
            }
            
            try {
                window.open(telegramUrl, '_blank');
                document.querySelector('.modal').remove();
            } catch (error) {
                openTelegramWeb(matchId);
            }
        }

        function copyTelegramText(matchId) {
            const report = generateMatchReport(matchId);
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(report).then(() => {
                    alert('‚úÖ Report copiato! Incollalo nella chat Telegram con l\'organizzatore.');
                    if (document.querySelector('.modal')) {
                        document.querySelector('.modal').remove();
                    }
                });
            } else {
                fallbackCopyTextToClipboard(report);
                if (document.querySelector('.modal')) {
                    document.querySelector('.modal').remove();
                }
            }
        }

        function copyMatchData(matchId) {
            const report = generateMatchReport(matchId);
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(report).then(() => {
                    alert('‚úÖ Dati della partita copiati negli appunti! Ora puoi incollarli dove preferisci.');
                }).catch(() => {
                    fallbackCopyTextToClipboard(report);
                });
            } else {
                fallbackCopyTextToClipboard(report);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('‚úÖ Dati della partita copiati negli appunti!');
            } catch (err) {
                alert('‚ùå Impossibile copiare automaticamente. Seleziona e copia manualmente il testo che apparir√†.');
                prompt('Copia questo testo:', text);
            }
            
            document.body.removeChild(textArea);
        }

        function downloadMatchReport(matchId) {
            const report = generateMatchReport(matchId);
            const match = matches.find(m => m.id === matchId);
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${homeTeam.name}_vs_${awayTeam.name}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function getArbitratorName() {
            return localStorage.getItem('arbitrator_name') || null;
        }

        function setArbitratorName() {
            const name = prompt('Inserisci il tuo nome (arbitro):', getArbitratorName() || '');
            if (name) {
                localStorage.setItem('arbitrator_name', name);
                alert(`Nome arbitro salvato: ${name}`);
                updateArbitratorDisplay();
            }
        }

        function showDataCollectionInstructions() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.remove()">&times;</span>
                    <h3>üìñ Istruzioni per gli Arbitri</h3>
                    <div style="text-align: left; line-height: 1.6;">
                        <h4>üéØ Come inviare i risultati:</h4>
                        <ol>
                            <li><strong>Imposta il tuo nome</strong> nel pannello arbitro (pulsante "üë§ Imposta Nome Arbitro")</li>
                            <li><strong>Seleziona la partita</strong> che stai arbitrando</li>
                            <li><strong>Inserisci le statistiche</strong> di ogni giocatore (gol, scalpi, MVP)</li>
                            <li><strong>Clicca "Termina Partita"</strong> quando finita</li>
                            <li><strong>Scegli un metodo di invio</strong>:</li>
                        </ol>
                        
                        <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <h4>üìß Email Organizzatore:</h4>
                            <p><strong>${prompt('Inserisci la tua email per mostrarla agli arbitri:', 'organizzatore@torneo.com') || 'organizzatore@torneo.com'}</strong></p>
                        </div>
                        
                        <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <h4>üì± WhatsApp Organizzatore:</h4>
                            <p><strong>${prompt('Inserisci il tuo numero WhatsApp per mostrarlo agli arbitri:', '+393401234567') || '+393401234567'}</strong></p>
                        </div>
                        
                        <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px;">
                            <strong>üí° Consiglio:</strong> Condividi questo link con gli arbitri:<br>
                            <code>${window.location.href}</code>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function processArbitratorReports() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.remove()">&times;</span>
                    <h3>üîÑ Elabora Report Ricevuti</h3>
                    <p>Incolla qui i report ricevuti dagli arbitri:</p>
                    <textarea id="reportInput" style="width: 100%; height: 300px; margin: 10px 0;" 
                              placeholder="Incolla qui il report della partita ricevuto dall'arbitro..."></textarea>
                    <div style="text-align: center;">
                        <button class="btn btn-primary" onclick="parseArbitratorReport()">
                            üìä Elabora Report
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function parseArbitratorReport() {
            const reportText = document.getElementById('reportInput').value.trim();
            if (!reportText) {
                alert('Inserisci il report da elaborare');
                return;
            }
            
            try {
                const result = parseReportText(reportText);
                if (result.success) {
                    alert(result.message);
                    document.querySelector('.modal').remove();
                    displayStandings();
                    displayStats();
                } else {
                    alert('Errore: ' + result.message);
                }
            } catch (error) {
                alert('Errore nell\'elaborazione del report: ' + error.message);
            }
        }

        function parseReportText(reportText) {
            try {
                // Estrai ID partita dal report
                const idMatch = reportText.match(/üî¢ ID PARTITA: (\d+)/);
                if (!idMatch) {
                    return { success: false, message: 'Report non valido: ID partita non trovato' };
                }
                
                const matchId = parseInt(idMatch[1]);
                const match = matches.find(m => m.id === matchId);
                
                if (!match) {
                    return { success: false, message: 'Partita non trovata nel sistema' };
                }
                
                // Estrai il risultato
                const scoreMatch = reportText.match(/üìä Risultato: (.+) (\d+) - (\d+) (.+)/);
                if (scoreMatch) {
                    const homeScore = parseInt(scoreMatch[2]);
                    const awayScore = parseInt(scoreMatch[3]);
                    match.homeScore = homeScore;
                    match.awayScore = awayScore;
                }
                
                // Estrai statistiche giocatori
                const homeTeam = teams.find(t => t.id === match.homeTeamId);
                const awayTeam = teams.find(t => t.id === match.awayTeamId);
                
                // Reset statistiche partita
                match.playerStats = {};
                match.homeMVP = null;
                match.awayMVP = null;
                
                // Parse statistiche squadra casa
                const homeSection = reportText.match(new RegExp(`üè† ${homeTeam.name.toUpperCase()}[\\s\\S]*?(?=üöå|$)`));
                if (homeSection) {
                    parseTeamStats(homeSection[0], homeTeam, match, 'home');
                }
                
                // Parse statistiche squadra ospite
                const awaySection = reportText.match(new RegExp(`üöå ${awayTeam.name.toUpperCase()}[\\s\\S]*?(?=üìã|$)`));
                if (awaySection) {
                    parseTeamStats(awaySection[0], awayTeam, match, 'away');
                }
                
                // Segna partita come completata
                match.status = 'completed';
                if (!match.completedAt) {
                    match.completedAt = new Date().toISOString();
                }
                
                // Aggiorna statistiche
                updateTeamStats(match);
                updatePlayerStats(match);
                saveData();
                
                return { 
                    success: true, 
                    message: `‚úÖ Report elaborato con successo!\\n\\nPartita: ${homeTeam.name} vs ${awayTeam.name}\\nRisultato: ${match.homeScore} - ${match.awayScore}\\nStato: Aggiornato nel sistema` 
                };
                
            } catch (error) {
                return { success: false, message: error.message };
            }
        }

        function parseTeamStats(sectionText, team, match, side) {
            const lines = sectionText.split('\n');
            
            lines.forEach(line => {
                const statMatch = line.match(/#(\d+) (.+?): (\d+) gol, (\d+) scalpi(.*)$/);
                if (statMatch) {
                    const playerNumber = parseInt(statMatch[1]);
                    const goals = parseInt(statMatch[3]);
                    const scalps = parseInt(statMatch[4]);
                    const isMVP = statMatch[5].includes('‚≠ê MVP');
                    
                    const player = team.players.find(p => p.number === playerNumber);
                    if (player) {
                        match.playerStats[player.id] = { goals, scalps };
                        if (isMVP) {
                            if (side === 'home') {
                                match.homeMVP = player.id;
                            } else {
                                match.awayMVP = player.id;
                            }
                        }
                    }
                }
            });
        }

        // Nuove funzioni per il pannello admin
        function processBulkReports() {
            const bulkText = document.getElementById('bulkReportsInput').value.trim();
            if (!bulkText) {
                alert('Inserisci i report da elaborare');
                return;
            }
            
            // Dividi i report basandosi sul separatore
            const reports = bulkText.split('üèÜ REPORT PARTITA PALLASCOUT üèÜ').filter(r => r.trim());
            
            let processed = 0;
            let errors = [];
            
            reports.forEach((reportText, index) => {
                if (reportText.trim()) {
                    const fullReport = 'üèÜ REPORT PARTITA PALLASCOUT üèÜ' + reportText;
                    const result = parseReportText(fullReport);
                    
                    if (result.success) {
                        processed++;
                    } else {
                        errors.push(`Report ${index + 1}: ${result.message}`);
                    }
                }
            });
            
            let message = `‚úÖ Elaborati ${processed} report su ${reports.length}`;
            if (errors.length > 0) {
                message += `\\n\\n‚ùå Errori:\\n${errors.join('\\n')}`;
            }
            
            alert(message);
            document.getElementById('bulkReportsInput').value = '';
            displayStandings();
            displayStats();
            updateMatchStatusSummary();
        }

        function processReportFiles(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            
            let processed = 0;
            let errors = [];
            
            const processFile = (file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        let content = e.target.result;
                        
                        if (file.name.endsWith('.json')) {
                            const data = JSON.parse(content);
                            if (data.teams && data.matches) {
                                // Merge dei dati JSON
                                mergeData(data);
                                processed++;
                            }
                        } else {
                            // File di testo con report
                            const result = parseReportText(content);
                            if (result.success) {
                                processed++;
                            } else {
                                errors.push(`${file.name}: ${result.message}`);
                            }
                        }
                        
                        // Se √® l'ultimo file, mostra il risultato
                        if (index === files.length - 1) {
                            let message = `‚úÖ Elaborati ${processed} file su ${files.length}`;
                            if (errors.length > 0) {
                                message += `\\n\\n‚ùå Errori:\\n${errors.join('\\n')}`;
                            }
                            alert(message);
                            displayStandings();
                            displayStats();
                            updateMatchStatusSummary();
                        }
                    } catch (error) {
                        errors.push(`${file.name}: ${error.message}`);
                    }
                };
                reader.readAsText(file);
            };
            
            files.forEach(processFile);
        }

        function mergeData(importedData) {
            // Merge teams (evita duplicati)
            importedData.teams.forEach(importedTeam => {
                const existingTeam = teams.find(t => t.name === importedTeam.name);
                if (!existingTeam) {
                    teams.push(importedTeam);
                }
            });
            
            // Merge matches (evita duplicati per ID)
            importedData.matches.forEach(importedMatch => {
                const existingMatch = matches.find(m => m.id === importedMatch.id);
                if (!existingMatch) {
                    matches.push(importedMatch);
                } else if (importedMatch.status === 'completed' && existingMatch.status !== 'completed') {
                    // Aggiorna match esistente con dati completati
                    Object.assign(existingMatch, importedMatch);
                }
            });
            
            saveData();
        }

        function importCompleteData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.teams && data.matches) {
                        const overwrite = confirm('Vuoi sovrascrivere i dati esistenti o unire con quelli attuali?\\n\\nOK = Sovrascrivi\\nAnnulla = Unisci');
                        
                        if (overwrite) {
                            teams = data.teams;
                            matches = data.matches;
                        } else {
                            mergeData(data);
                        }
                        
                        saveData();
                        alert('‚úÖ Dati importati con successo!');
                        displayTeams();
                        displayStandings();
                        displayStats();
                        updateMatchStatusSummary();
                    } else {
                        alert('‚ùå File non valido');
                    }
                } catch (error) {
                    alert('‚ùå Errore nell\'importazione: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function updateTeamStats(match) {
            const homeTeam = teams.find(t => t.id === match.homeTeamId);
            const awayTeam = teams.find(t => t.id === match.awayTeamId);

            if (!homeTeam || !awayTeam) return;

            // Verifica se le statistiche sono gi√† state aggiornate per questa partita
            if (match.statsUpdated) return;

            // Aggiorna statistiche squadra casa
            homeTeam.stats.matches++;
            homeTeam.stats.goalsFor += match.homeScore || 0;
            homeTeam.stats.goalsAgainst += match.awayScore || 0;

            // Aggiorna statistiche squadra ospite
            awayTeam.stats.matches++;
            awayTeam.stats.goalsFor += match.awayScore || 0;
            awayTeam.stats.goalsAgainst += match.homeScore || 0;

            // Determina il risultato
            if ((match.homeScore || 0) > (match.awayScore || 0)) {
                homeTeam.stats.wins++;
                homeTeam.stats.points += 3;
                awayTeam.stats.losses++;
            } else if ((match.homeScore || 0) < (match.awayScore || 0)) {
                awayTeam.stats.wins++;
                awayTeam.stats.points += 3;
                homeTeam.stats.losses++;
            } else {
                homeTeam.stats.draws++;
                awayTeam.stats.draws++;
                homeTeam.stats.points += 1;
                awayTeam.stats.points += 1;
            }

            // Aggiorna scalpi
            if (match.playerStats) {
                homeTeam.players.forEach(player => {
                    if (match.playerStats[player.id]) {
                        homeTeam.stats.scalpFor += match.playerStats[player.id].scalps || 0;
                    }
                });

                awayTeam.players.forEach(player => {
                    if (match.playerStats[player.id]) {
                        awayTeam.stats.scalpFor += match.playerStats[player.id].scalps || 0;
                    }
                });
            }

            // Segna che le statistiche sono state aggiornate
            match.statsUpdated = true;
        }

        function updatePlayerStats(match) {
            // Verifica se le statistiche giocatori sono gi√† state aggiornate
            if (match.playerStatsUpdated) return;

            // Aggiorna statistiche giocatori
            if (match.playerStats) {
                Object.keys(match.playerStats).forEach(playerId => {
                    const playerIdInt = parseInt(playerId);
                    let player = null;
                    
                    // Trova il giocatore nelle squadre
                    teams.forEach(team => {
                        const foundPlayer = team.players.find(p => p.id === playerIdInt);
                        if (foundPlayer) player = foundPlayer;
                    });
                    
                    if (player && match.playerStats[playerId]) {
                        player.stats.goals += match.playerStats[playerId].goals || 0;
                        player.stats.scalps += match.playerStats[playerId].scalps || 0;
                    }
                });
            }

            // Aggiorna MVP
            if (match.homeMVP) {
                teams.forEach(team => {
                    const player = team.players.find(p => p.id === match.homeMVP);
                    if (player) player.stats.mvp++;
                });
            }
            
            if (match.awayMVP) {
                teams.forEach(team => {
                    const player = team.players.find(p => p.id === match.awayMVP);
                    if (player) player.stats.mvp++;
                });
            }

            // Segna che le statistiche giocatori sono state aggiornate
            match.playerStatsUpdated = true;
        }

        // Visualizza classifica
        function displayStandings() {
            const standingsTable = document.getElementById('standingsTable');
            
            // Ordina le squadre per punti, poi per differenza reti
            const sortedTeams = [...teams].sort((a, b) => {
                if (b.stats.points !== a.stats.points) {
                    return b.stats.points - a.stats.points;
                }
                const diffA = a.stats.goalsFor - a.stats.goalsAgainst;
                const diffB = b.stats.goalsFor - b.stats.goalsAgainst;
                return diffB - diffA;
            });

            let tableHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Squadra</th>
                            <th>G</th>
                            <th>V</th>
                            <th>P</th>
                            <th>S</th>
                            <th>GF</th>
                            <th>GS</th>
                            <th>DR</th>
                            <th>Pts</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedTeams.forEach((team, index) => {
                const goalDiff = team.stats.goalsFor - team.stats.goalsAgainst;
                tableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${team.name}</strong></td>
                        <td>${team.stats.matches}</td>
                        <td>${team.stats.wins}</td>
                        <td>${team.stats.draws}</td>
                        <td>${team.stats.losses}</td>
                        <td>${team.stats.goalsFor}</td>
                        <td>${team.stats.goalsAgainst}</td>
                        <td>${goalDiff > 0 ? '+' : ''}${goalDiff}</td>
                        <td><strong>${team.stats.points}</strong></td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            standingsTable.innerHTML = tableHTML;
        }

        // Visualizza statistiche
        function displayStats() {
            const statsContent = document.getElementById('statsContent');
            
            // Statistiche giocatori - Migliori marcatori
            const allPlayers = [];
            teams.forEach(team => {
                team.players.forEach(player => {
                    allPlayers.push({
                        ...player,
                        teamName: team.name
                    });
                });
            });

            const topScorers = [...allPlayers]
                .filter(p => p.stats.goals > 0)
                .sort((a, b) => b.stats.goals - a.stats.goals)
                .slice(0, 10);

            const topScalpers = [...allPlayers]
                .filter(p => p.stats.scalps > 0)
                .sort((a, b) => b.stats.scalps - a.stats.scalps)
                .slice(0, 10);

            const topMVPs = [...allPlayers]
                .filter(p => p.stats.mvp > 0)
                .sort((a, b) => b.stats.mvp - a.stats.mvp)
                .slice(0, 10);

            let statsHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="card">
                        <h3>ü•Ö Migliori Marcatori</h3>
                        <table class="table">
                            <thead>
                                <tr><th>Giocatore</th><th>Squadra</th><th>Gol</th></tr>
                            </thead>
                            <tbody>
                                ${topScorers.map((player, i) => `
                                    <tr>
                                        <td>#${player.number} ${player.name}</td>
                                        <td>${player.teamName}</td>
                                        <td><strong>${player.stats.goals}</strong></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div class="card">
                        <h3>‚öîÔ∏è Migliori Scalpers</h3>
                        <table class="table">
                            <thead>
                                <tr><th>Giocatore</th><th>Squadra</th><th>Scalpi</th></tr>
                            </thead>
                            <tbody>
                                ${topScalpers.map((player, i) => `
                                    <tr>
                                        <td>#${player.number} ${player.name}</td>
                                        <td>${player.teamName}</td>
                                        <td><strong>${player.stats.scalps}</strong></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div class="card">
                        <h3>üèÜ Pi√π MVP</h3>
                        <table class="table">
                            <thead>
                                <tr><th>Giocatore</th><th>Squadra</th><th>MVP</th></tr>
                            </thead>
                            <tbody>
                                ${topMVPs.map((player, i) => `
                                    <tr>
                                        <td>#${player.number} ${player.name}</td>
                                        <td>${player.teamName}</td>
                                        <td><strong>${player.stats.mvp}</strong></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h3>üìä Statistiche Generali</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; text-align: center;">
                        <div>
                            <h4>${teams.length}</h4>
                            <p>Squadre Registrate</p>
                        </div>
                        <div>
                            <h4>${allPlayers.length}</h4>
                            <p>Giocatori Registrati</p>
                        </div>
                        <div>
                            <h4>${matches.filter(m => m.status === 'completed').length}</h4>
                            <p>Partite Completate</p>
                        </div>
                        <div>
                            <h4>${matches.filter(m => m.status === 'in_progress').length}</h4>
                            <p>Partite in Corso</p>
                        </div>
                        <div>
                            <h4>${matches.filter(m => m.status === 'scheduled').length}</h4>
                            <p>Partite Programmate</p>
                        </div>
                        <div>
                            <h4>${allPlayers.reduce((sum, p) => sum + p.stats.goals, 0)}</h4>
                            <p>Gol Totali</p>
                        </div>
                        <div>
                            <h4>${allPlayers.reduce((sum, p) => sum + p.stats.scalps, 0)}</h4>
                            <p>Scalpi Totali</p>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h3>üì§ Raccolta Dati da Arbitri</h3>
                    <p>Per raccogliere i dati dagli arbitri, hai diverse opzioni:</p>
                    <div style="display: grid; gap: 15px; margin-top: 15px;">
                        <div style="padding: 15px; background: #e8f5e8; border-radius: 8px;">
                            <strong>üìß Via Email:</strong> Gli arbitri possono inviarti automaticamente il report via email
                        </div>
                        <div style="padding: 15px; background: #e8f8ff; border-radius: 8px;">
                            <strong>üì± Via WhatsApp:</strong> Invio diretto del report al tuo numero WhatsApp
                        </div>
                        <div style="padding: 15px; background: #fff3cd; border-radius: 8px;">
                            <strong>üìã Copia-Incolla:</strong> L'arbitro copia i dati e te li invia tramite chat/email
                        </div>
                        <div style="padding: 15px; background: #f8d7da; border-radius: 8px;">
                            <strong>üíæ File Report:</strong> Download di un file .txt con tutti i dati della partita
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="showDataCollectionInstructions()">
                            üìñ Istruzioni per Arbitri
                        </button>
                        <button class="btn btn-success" onclick="processArbitratorReports()">
                            üîÑ Elabora Report Ricevuti
                        </button>
                    </div>
                </div>
            `;

            statsContent.innerHTML = statsHTML;
        }

        // Funzioni di esportazione dati
        function exportData() {
            const data = {
                teams: teams,
                matches: matches,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pallascout_torneo_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.teams && data.matches) {
                        teams = data.teams;
                        matches = data.matches;
                        saveData();
                        alert('Dati importati con successo!');
                        displayTeams();
                    } else {
                        alert('File non valido');
                    }
                } catch (error) {
                    alert('Errore nell\'importazione: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Aggiungi pulsanti di esportazione/importazione nella sezione squadre
        function addDataButtons() {
            const teamsTab = document.getElementById('teams');
            const dataButtons = document.createElement('div');
            dataButtons.innerHTML = `
                <div style="margin: 20px 0; text-align: center;">
                    <button class="btn btn-success" onclick="exportData()">üì• Esporta Dati</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                    <button class="btn btn-warning" onclick="document.getElementById('importFile').click()">üì§ Importa Dati</button>
                    <button class="btn btn-danger" onclick="resetAllData()">üóëÔ∏è Reset Tutti i Dati</button>
                </div>
            `;
            teamsTab.appendChild(dataButtons);
        }

        function resetAllData() {
            if (confirm('ATTENZIONE: Questa operazione canceller√† tutti i dati. Sei sicuro?')) {
                teams = [];
                matches = [];
                localStorage.removeItem('pallascout_teams');
                localStorage.removeItem('pallascout_matches');
                alert('Tutti i dati sono stati cancellati');
                displayTeams();
            }
        }

        // Aggiungi stili CSS mancanti
        const additionalStyles = `
            <style>
                .badge {
                    display: inline-block;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: bold;
                }
                
                .badge-secondary {
                    background: #6c757d;
                    color: white;
                }
                
                .badge-warning {
                    background: #ffc107;
                    color: #212529;
                }
                
                .badge-success {
                    background: #28a745;
                    color: white;
                }
                
                .player-stats {
                    margin: 10px 0;
                    padding: 10px;
                    background: #f8f9fa;
                    border-radius: 8px;
                }
                
                .score {
                    font-size: 24px;
                    font-weight: bold;
                    color: #3498db;
                }
            </style>
        `;

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            displayTeams();
            addDataButtons();
            
            // Aggiungi stili aggiuntivi
            document.head.insertAdjacentHTML('beforeend', additionalStyles);
            
            // Debug iniziale
            console.log('App inizializzata');
            console.log('Teams:', teams);
            console.log('Matches:', matches);
            
            // Test per verificare che gli elementi esistano
            setTimeout(() => {
                const refereeSelect = document.getElementById('refereeMatchSelect');
                console.log('Referee select element:', refereeSelect);
                if (refereeSelect) {
                    updateRefereeMatchSelect();
                }
            }, 100);
        });
    </script>
</body>
</html>